#!/bin/bash

# =================================================================
#  Turnstile Solver 初始化脚本 (for Linux/macOS)
# =================================================================
#
#  该脚本用于执行以下操作:
#  1. 确保 'camoufox_cache' 目录存在，用于存放浏览器文件。
#  2. 运行一次性的 fetch 命令，下载 Camoufox 浏览器和相关依赖。
#
#  在首次启动服务前，或在清除了缓存后，请运行此脚本。
#  使用方法: bash init.sh
# =================================================================

# 设置颜色变量（可选，为了美观）
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# 如果脚本执行出错，则立即退出
set -e

echo -e "${GREEN}--- [1/2] 正在检查并创建 'camoufox_cache' 目录...${NC}"
mkdir -p camoufox_cache
echo "目录 'camoufox_cache' 已准备就绪。"
echo ""

echo -e "${GREEN}--- [2/2] 准备执行 Camoufox 浏览器下载程序...${NC}"
echo -e "${YELLOW}******************************************************"
echo -e "*  注意: 此过程将下载数百MB的文件，耗时较长，      *"
echo -e "*  具体时间取决于您的网络速度，请耐心等待...       *"
echo -e "******************************************************${NC}"
echo ""

# 执行核心下载命令
docker compose run --rm turnstile_solver python -m camoufox fetch

echo ""
echo -e "${GREEN}============================================================${NC}"
echo ""
echo -e "    ${GREEN}初始化成功！${NC}"
echo ""
echo -e "    所有必要的浏览器文件都已下载到 'camoufox_cache' 目录。"
echo -e "    现在您可以使用 'docker compose up -d' 来启动主服务了。"
echo ""
echo -e "${GREEN}============================================================${NC}"
